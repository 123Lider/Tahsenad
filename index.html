<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Dashboard Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0b0b0b; color: white; margin: 0; height: 100vh; overflow: hidden; }
        #toastBox { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #00e676; color: #000; padding: 12px 25px; border-radius: 30px; font-weight: bold; display: none; z-index: 9999; }
        #dashboard { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; gap: 20px; }
        .dash-card { width: 85%; max-width: 320px; padding: 35px 20px; background: #1a1a1a; border-radius: 20px; text-align: center; cursor: pointer; border: 1px solid #333; }
        .page { display: none; flex-direction: column; height: 100vh; background: #0b0b0b; }
        .header { background: #111; padding: 15px; display: flex; align-items: center; border-bottom: 1px solid #333; }
        .back-btn { background: #333; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; margin-right: 15px; }
        .content-area { padding: 20px; overflow-y: auto; flex-grow: 1; }
        textarea { width: 100%; height: 120px; background: #111; color: white; border: 1px solid #444; padding: 12px; font-size: 16px; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn { padding: 14px; border: none; font-weight: bold; cursor: pointer; flex: 1; text-align: center; font-size: 13px; border-radius: 10px; }
        .btn-blue { background: #2196F3; color: white; }
        .btn-orange { background: #ff9800; color: white; }
        .btn-red { background: #f44336; color: white; }
        #mainVideo { width: 95%; max-width: 450px; height: 230px; border-radius: 15px; background: #000; border: 2px solid #333; display: block; margin: 10px auto; }
        .list-section { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .clip-card { background: #181818; margin-bottom: 10px; padding: 12px; border-radius: 12px; display: flex; align-items: center; border: 1px solid #222; }
        .save-btn { background: #00e676; color: black; border: none; padding: 8px 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div id="toastBox">Action Successful!</div>
    <div id="dashboard">
        <h1 style="color: #00e676;">Admin Panel</h1>
        <div class="dash-card" onclick="showPage('videoPage')"><h2>üé• Video History</h2></div>
        <div class="dash-card" onclick="showPage('controlPage')"><h2>üñ•Ô∏è Remote Control</h2></div>
    </div>

    <div id="videoPage" class="page">
        <div class="header"><button class="back-btn" onclick="showDashboard()">‚Üê Back</button><h3>Videos</h3></div>
        <video id="mainVideo" controls autoplay muted playsinline></video>
        <div style="padding:10px; text-align:center;"><button class="btn-red" onclick="doDelete()">Delete Selected</button></div>
        <div class="list-section" id="videoList"></div>
    </div>

    <div id="controlPage" class="page">
        <div class="header"><button class="back-btn" onclick="showDashboard()">‚Üê Back</button><h3>Control</h3></div>
        <div class="content-area">
            <textarea id="remoteMsg" placeholder="Message..."></textarea>
            <div class="btn-group">
                <button class="btn btn-blue" onclick="sendText()">Update Text</button>
                <button class="btn btn-red" onclick="clearText()">Clear Text</button>
            </div>
            <input type="file" id="picInput" accept="image/*" style="margin: 15px 0; color: #555;">
            <div class="btn-group">
                <button class="btn btn-orange" onclick="uploadPic()">Upload (Original Quality)</button>
                <button class="btn btn-red" onclick="clearImage()">Delete Pic</button>
            </div>
            <button class="btn btn-red" style="width:100%; background:#444;" onclick="clearAll()">FAST CLEAR ALL</button>
        </div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBqeyPDHeWvvKsDXOp13JkVYMaWaPM9dko", authDomain: "camera-92fee.firebaseapp.com", projectId: "camera-92fee", storageBucket: "camera-92fee.firebasestorage.app", messagingSenderId: "530687776530", appId: "1:530687776530:web:95c00e598e07d33dbac5cb" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        let selectedIds = [];

        function showPage(id) { document.getElementById('dashboard').style.display='none'; document.getElementById(id).style.display='flex'; }
        function showDashboard() { document.querySelectorAll('.page').forEach(p=>p.style.display='none'); document.getElementById('dashboard').style.display='flex'; }
        function showToast(msg) { const t=document.getElementById('toastBox'); t.innerText=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',2500); }

        function sendText() { db.collection("control").doc("currentStatus").set({ type: 'text', content: document.getElementById('remoteMsg').value }, {merge: true}).then(()=>showToast("Text Updated!")); }
        function clearText() { db.collection("control").doc("currentStatus").update({ content: "" }).then(()=>showToast("Text Deleted!")); }
        
        function uploadPic() {
            const file = document.getElementById('picInput').files[0];
            if(!file) return showToast("Select Image!");
            showToast("Uploading Full Quality...");
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                db.collection("control").doc("currentStatus").set({
                    type: 'image',
                    content: reader.result,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                }).then(()=>showToast("Pic Live Now!"));
            };
        }
        
        function clearImage() { db.collection("control").doc("currentStatus").update({ type: 'text' }).then(()=>showToast("Image Deleted!")); }
        function clearAll() { db.collection("control").doc("currentStatus").set({ type: 'clear', content: '' }).then(()=>showToast("Cleared!")); }

        db.collection("recordings").orderBy("timestamp", "desc").limit(30).onSnapshot(snap => {
            const list = document.getElementById('videoList'); list.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data(); const ts = d.timestamp ? d.timestamp.toDate().toLocaleTimeString() : "New";
                const card = document.createElement('div'); card.className = 'clip-card';
                card.innerHTML = `<input type="checkbox" onchange="toggleClip('${doc.id}')"><div style="flex:1" onclick="play('${d.videoData}')">üïí ${ts}</div><button class="save-btn" onclick="save('${d.videoData}')">Save</button>`;
                list.appendChild(card);
            });
        });
        function play(url) { document.getElementById('mainVideo').src=url; document.getElementById('mainVideo').play(); }
        function save(url) { const a=document.createElement('a'); a.href=url; a.download="vid.webm"; a.click(); }
        function toggleClip(id) { if(selectedIds.includes(id)) selectedIds=selectedIds.filter(i=>i!==id); else selectedIds.push(id); }
        async function doDelete() { const batch=db.batch(); selectedIds.forEach(id=>batch.delete(db.collection("recordings").doc(id))); await batch.commit(); selectedIds=[]; showToast("Deleted!"); }
    </script>
</body>
</html>
